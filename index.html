<script>
document.addEventListener('DOMContentLoaded', function() {
    // 提交表单（保持不变）
    const submitBtn = document.getElementById('submit-btn');
    submitBtn.addEventListener('click', function() {
        // ...原有收集表单数据的代码...
        
        // 隐藏表单页面，显示成功页面
        document.getElementById('form-page').style.display = 'none';
        document.getElementById('success-page').style.display = 'block';
    });

    // 1. 查看已填内容 - 增强版新标签页打开
    const viewContentBtn = document.getElementById('view-content-btn');
    viewContentBtn.addEventListener('click', function() {
        // 从localStorage获取数据
        const formData = JSON.parse(localStorage.getItem('formData'));
        
        // 准备要在新窗口显示的内容
        const content = `
            <!DOCTYPE html>
            <html>
            <head>
                <title>已填内容</title>
                <style>body { font-family: Arial; padding: 20px; }</style>
            </head>
            <body>
                <h2>您提交的内容</h2>
                <p>语言: ${formData.language || '未选择'}</p>
                <p>设备: ${formData.devices?.join(', ') || '未选择'}</p>
                <!-- 其他字段... -->
                <button onclick="window.close()">关闭</button>
            </body>
            </html>
        `;
        
        // 尝试打开新窗口
        const newWindow = window.open('', '_blank');
        if (newWindow) {
            newWindow.document.write(content);
            newWindow.document.close();
        } else {
            // 如果被拦截，提示用户
            alert('请允许弹出窗口，或手动查看已填内容');
            // 降级方案：在当前页显示
            document.getElementById('success-page').style.display = 'none';
            document.getElementById('data-preview').style.display = 'block';
            document.getElementById('preview-content').innerHTML = content;
        }
    });

    // 2. 再填一次 - 增强版新标签页打开
    const fillAgainBtn = document.getElementById('fill-again-btn');
    fillAgainBtn.addEventListener('click', function() {
        // 获取当前页面URL
        const currentUrl = window.location.href;
        
        // 尝试打开新窗口
        const newWindow = window.open(currentUrl, '_blank');
        
        if (!newWindow || newWindow.closed) {
            // 如果被拦截，提示用户
            alert('请允许弹出窗口，或手动复制链接到新标签页打开');
            // 降级方案：在当前页重置表单
            document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
                input.checked = false;
            });
            document.getElementById('city-select').value = '北京';
            document.getElementById('date-input').value = '';
            document.getElementById('file-upload').value = '';
            document.getElementById('success-page').style.display = 'none';
            document.getElementById('form-page').style.display = 'block';
        }
    });

    // 返回按钮（保持不变）
    const backBtn = document.getElementById('back-btn');
    backBtn.addEventListener('click', function() {
        document.getElementById('data-preview').style.display = 'none';
        document.getElementById('success-page').style.display = 'block';
    });
});
</script>
